import{g as p,y as O,z as A,j as H,A as k,B as S,c as a,o as i,a as t,x as I,p as j,s as C,C as w,D as h,d as v,t as g,F as N,r as P}from"./DYX1uUzg.js";const _={class:"min-h-screen flex items-center justify-center bg-gradient-to-br from-amber-50 to-amber-100 py-12 px-4 sm:px-6 lg:px-8"},q={class:"max-w-md w-full space-y-8"},K={class:"mt-8 bg-white py-8 px-4 shadow-xl rounded-xl sm:px-10 transform transition-all duration-300 hover:shadow-2xl"},U={class:"mt-1 relative rounded-md shadow-sm"},L=["disabled"],$={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},F={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},R={class:"text-center text-sm text-gray-600 mb-6 bg-amber-50 p-4 rounded-lg border border-amber-100"},G={class:"mt-2 text-amber-600 font-medium",dir:"ltr"},J={class:"mt-1 flex justify-center gap-2 flex-row-reverse"},Q=["onUpdate:modelValue","onInput","onKeydown"],W={class:"flex items-center justify-between"},X=["disabled"],Y={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Z={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 ml-2 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},oe={__name:"login",setup(ee){const m=p(1),u=p(""),c=p(""),n=p(["","","","","",""]),r=p(!1),{login:T}=O(),d=A(),{$api:x}=H();k(m,o=>{o===2&&setTimeout(()=>{const e=document.querySelectorAll('input[type="text"]');e.length>0&&e[0].focus()},0)});const V=S(()=>n.value.join(""));k(V,o=>{c.value=o});const B=(o,e)=>{const s=o.target.value;if(!/^\d*$/.test(s)){n.value[e]="";return}n.value[e]=s,s&&e<5&&setTimeout(()=>{const l=o.target.parentElement.children[e+1];l&&l.focus()},0),e===5&&s&&setTimeout(()=>{b()},100)},M=(o,e)=>{if(o.key==="Backspace")if(!n.value[e]&&e>0){n.value[e-1]="";const s=o.target.parentElement.children[e-1];s&&s.focus()}else n.value[e]="";if(o.key==="v"&&(o.ctrlKey||o.metaKey)){o.preventDefault();const l=o.clipboardData.getData("text").match(/\d/g);l&&l.slice(0,6).forEach((E,f)=>{f<6&&(n.value[f]=E,f<5&&setTimeout(()=>{const y=o.target.parentElement.children[f+1];y&&y.focus()},0))})}},z=async()=>{if(!u.value){d.error("لطفا ایمیل خود را وارد کنید");return}r.value=!0;try{const o=await x.auth.requestOTP(u.value);m.value=2,d.success("کد تایید به ایمیل شما ارسال شد")}catch(o){const e=o instanceof Error?o.message:"خطا در ارسال کد تایید";d.error(e)}finally{r.value=!1}},b=async()=>{if(c.value.length!==6){d.error("کد تایید باید 6 رقم باشد");return}r.value=!0;try{const o=await x.auth.verifyOTP(u.value,c.value);if(console.log("Login response:",o),o&&o.data)T(o.data.token,{id:o.data.user.id,email:o.data.user.email,name:o.data.user.firstName+" "+o.data.user.lastName}),d.success("ورود با موفقیت انجام شد"),window.location.href="/";else throw console.error("Invalid response structure:",o),new Error("پاسخ نامعتبر از سرور")}catch(o){console.error("OTP verification error:",o),d.error(o.message||"خطا در تایید کد")}finally{r.value=!1}},D=async()=>{r.value=!0;try{n.value=["","","","","",""],setTimeout(()=>{const o=document.querySelectorAll('input[type="text"]');o.length>0&&o[0].focus()},0),console.log("Resending OTP to:",u.value)}catch(o){console.error("Error resending OTP:",o)}finally{r.value=!1}};return(o,e)=>(i(),a("div",_,[t("div",q,[e[15]||(e[15]=I('<div class="text-center"><div class="flex justify-center"><div class="w-20 h-20 bg-amber-500 rounded-full flex items-center justify-center shadow-lg transform transition-transform hover:scale-105"><svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div></div><h2 class="mt-6 text-3xl font-extrabold text-gray-900"> ورود به سیستم </h2><p class="mt-2 text-sm text-gray-600"> برای دسترسی به اطلاعات خود وارد شوید </p></div>',1)),t("div",K,[m.value===1?(i(),a("form",{key:0,onSubmit:C(z,["prevent"]),class:"space-y-6"},[t("div",null,[e[4]||(e[4]=t("label",{for:"email",class:"block text-sm font-medium text-gray-700"}," ایمیل سازمانی ",-1)),t("div",U,[e[3]||(e[3]=t("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})])],-1)),w(t("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),name:"email",type:"email",autocomplete:"email",required:"",dir:"ltr",class:"appearance-none block w-full px-3 py-2 pr-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm text-left",placeholder:"example@jabama.com"},null,512),[[h,u.value]])])]),t("div",null,[t("button",{type:"submit",disabled:r.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},[r.value?(i(),a("svg",$,e[5]||(e[5]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(i(),a("svg",F,e[6]||(e[6]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"},null,-1)]))),v(" "+g(r.value?"در حال ارسال...":"دریافت کد تایید"),1)],8,L)])],32)):j("",!0),m.value===2?(i(),a("form",{key:1,onSubmit:C(b,["prevent"]),class:"space-y-6"},[t("div",R,[e[7]||(e[7]=t("div",{class:"flex items-center justify-center mb-2"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-amber-500 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),t("p",{class:"font-medium"},"کد تایید ارسال شد")],-1)),e[8]||(e[8]=t("p",null,"کد شش رقمی به ایمیل سازمانی شما ارسال شد.",-1)),e[9]||(e[9]=t("p",null,"شما ۳ دقیقه فرصت دارید تا با استفاده از آن وارد شوید.",-1)),t("div",G,g(u.value),1)]),t("div",null,[e[10]||(e[10]=t("label",{for:"otp",class:"block text-sm font-medium text-gray-700"}," کد تایید ",-1)),t("div",J,[(i(),a(N,null,P(6,s=>w(t("input",{key:s,"onUpdate:modelValue":l=>n.value[s-1]=l,type:"text",maxlength:"1",pattern:"[0-9]*",inputmode:"numeric",dir:"ltr",class:"w-12 h-12 text-center text-xl font-bold border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all duration-200",onInput:l=>B(l,s-1),onKeydown:l=>M(l,s-1)},null,40,Q),[[h,n.value[s-1]]])),64))]),w(t("input",{type:"hidden","onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),name:"otp",required:""},null,512),[[h,c.value]])]),t("div",W,[t("button",{type:"button",onClick:e[2]||(e[2]=s=>m.value=1),class:"text-sm text-amber-600 hover:text-amber-500 flex items-center transition-colors duration-200"},e[11]||(e[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),v(" تغییر ایمیل ")])),t("button",{type:"button",onClick:D,class:"text-sm text-amber-600 hover:text-amber-500 flex items-center transition-colors duration-200"},e[12]||(e[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),v(" ارسال مجدد کد ")]))]),t("div",null,[t("button",{type:"submit",disabled:r.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},[r.value?(i(),a("svg",Y,e[13]||(e[13]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(i(),a("svg",Z,e[14]||(e[14]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"},null,-1)]))),v(" "+g(r.value?"در حال ورود...":"ورود"),1)],8,X)])],32)):j("",!0)])])]))}};export{oe as default};
