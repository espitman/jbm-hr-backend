import{_ as N}from"./D01jHPX4.js";import{_ as R}from"./D5qjO65t.js";import{j as C,c as n,o as i,a as e,F as j,m as q,t as m,b as h,l as z,g as F,D as M,G as P,r as d,B as b,n as y,A,w as D}from"./CSPX8tqz.js";import{_ as L}from"./DHxSmR5C.js";const T={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 items-end"},V={class:"flex flex-col"},E=["value"],G=["value"],K={class:"flex flex-col"},H=["value"],J={class:"flex flex-col"},O={class:"flex flex-col items-end"},W={__name:"Filters",props:{kind:{type:String,default:""},status:{type:String,default:""},userId:{type:String,default:""},kinds:{type:Array,required:!0},defaultUserId:{type:String,default:""}},emits:["update:kind","update:status","update:userId","clear"],setup(p,{emit:c}){const f=p,_=c,g=C(()=>!!(f.kind||f.status||f.userId));return(v,s)=>(i(),n("div",T,[e("div",V,[s[5]||(s[5]=e("label",{class:"text-sm font-medium text-gray-700 mb-1"},"نوع درخواست",-1)),e("select",{class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-200 focus:border-purple-300 transition w-full text-sm",value:p.kind,onChange:s[0]||(s[0]=o=>v.$emit("update:kind",o.target.value))},[s[4]||(s[4]=e("option",{value:"",class:"text-gray-400"},"همه انواع",-1)),(i(!0),n(j,null,q(p.kinds,o=>(i(),n("option",{key:o.value,value:o.value},m(o.label),9,G))),128))],40,E)]),e("div",K,[s[7]||(s[7]=e("label",{class:"text-sm font-medium text-gray-700 mb-1"},"وضعیت",-1)),e("select",{class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-200 focus:border-purple-300 transition w-full text-sm",value:p.status,onChange:s[1]||(s[1]=o=>v.$emit("update:status",o.target.value))},s[6]||(s[6]=[e("option",{value:"",class:"text-gray-400"},"همه وضعیت‌ها",-1),e("option",{value:"pending"},"در انتظار بررسی",-1),e("option",{value:"approved"},"تایید شده",-1),e("option",{value:"rejected"},"رد شده",-1)]),40,H)]),e("div",J,[s[8]||(s[8]=e("label",{class:"text-sm font-medium text-gray-700 mb-1"},"شناسه کاربر",-1)),h(L,{placeholder:"نام، ایمیل یا شماره کاربر را جستجو کنید","default-user-id":p.defaultUserId,onSelect:s[2]||(s[2]=o=>_("update:userId",(o==null?void 0:o.id)||""))},null,8,["default-user-id"])]),e("div",O,[g.value?(i(),n("button",{key:0,type:"button",class:"h-10 w-auto flex items-center justify-center gap-1 px-3 rounded-lg bg-red-500 text-white hover:bg-red-600 transition border-none mt-0",onClick:s[3]||(s[3]=o=>v.$emit("clear")),title:"پاک کردن فیلترها"},s[9]||(s[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),e("span",{class:"text-xs"},"پاک کردن",-1)]))):z("",!0)])]))}},X={class:"container mx-auto p-0"},Y={key:0,class:"flex justify-center items-center py-8"},Z={key:1,class:"text-center text-red-500"},Q={key:2},ee={class:"bg-white shadow-md rounded-lg overflow-hidden"},te={class:"min-w-full divide-y divide-gray-200"},se={class:"bg-white divide-y divide-gray-200"},ae={class:"px-6 py-4 whitespace-nowrap"},le={class:"text-sm text-gray-900"},oe={class:"px-6 py-4 whitespace-nowrap"},re={class:"text-sm text-gray-900"},ne={class:"px-6 py-4 whitespace-nowrap"},ie={class:"px-6 py-4 whitespace-nowrap"},ue={class:"text-sm text-gray-900"},de={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},xe={__name:"list",setup(p){const{$request:c,$api:f,$formatDate:_}=F(),g=M(),v=P(),s=d([]),o=d(!0),k=d(null),x=d(1),$=d(10),I=d(0),a=d({kind:"",status:"",userId:""}),S=C(()=>g.query.user_id||""),U=async()=>{console.log("filters",a.value);try{o.value=!0,k.value=null;const l={page:x.value,page_size:$.value};a.value.kind&&(l.kind=a.value.kind),a.value.status&&(l.status=a.value.status),a.value.userId&&(l.user_id=a.value.userId);const t=await f.get("/api/v1/admin/requests",l);s.value=t.data.items,I.value=t.data.total}catch(l){k.value=l.message||"خطا در دریافت اطلاعات درخواست‌ها"}finally{o.value=!1}};b(()=>g.query,async l=>{a.value.kind=l.kind||"",a.value.status=l.status||"",a.value.userId=l.user_id||"",l.page?x.value=parseInt(l.page):x.value=1,await U()},{immediate:!0}),b(()=>[a.value.kind,a.value.status,a.value.userId],([l,t,w])=>{const u={...g.query,page:1};l?u.kind=l:delete u.kind,t?u.status=t:delete u.status,w?u.user_id=w:delete u.user_id,v.push({query:u})}),b(()=>x.value,l=>{const t={...g.query,page:l};v.push({query:t})});const B=()=>{a.value.kind="",a.value.status="",a.value.userId=""};return(l,t)=>{const w=N,u=R;return i(),n("div",X,[t[7]||(t[7]=e("div",{class:"flex items-center justify-between mb-6"},[e("h1",{class:"text-xl font-bold text-purple-700"},"درخواست‌ها")],-1)),h(W,{kind:a.value.kind,status:a.value.status,"user-id":a.value.userId,kinds:y(c).getRequestKinds(),"default-user-id":S.value,"onUpdate:kind":t[0]||(t[0]=r=>a.value.kind=r),"onUpdate:status":t[1]||(t[1]=r=>a.value.status=r),"onUpdate:userId":t[2]||(t[2]=r=>a.value.userId=r),onClear:B},null,8,["kind","status","user-id","kinds","default-user-id"]),o.value?(i(),n("div",Y,t[4]||(t[4]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"},null,-1)]))):k.value?(i(),n("div",Z,m(k.value),1)):(i(),n("div",Q,[e("div",ee,[e("table",te,[t[6]||(t[6]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," نام و نام خانوادگی "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," نوع درخواست "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," وضعیت "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," تاریخ ثبت "),e("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," عملیات ")])],-1)),e("tbody",se,[(i(!0),n(j,null,q(s.value,r=>(i(),n("tr",{key:r.id},[e("td",ae,[e("div",le,m(r.full_name),1)]),e("td",oe,[e("div",re,m(y(c).getRequestTypeText(r.kind)),1)]),e("td",ne,[e("span",{class:A([y(c).getStatusClass(r.status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},m(y(c).getStatusText(r.status)),3)]),e("td",ie,[e("div",ue,m(y(_)(r.created_at)),1)]),e("td",de,[h(w,{to:`/requests/${r.id}`,class:"text-purple-600 hover:text-purple-900 ml-4 cursor-pointer"},{default:D(()=>t[5]||(t[5]=[e("div",{class:"inline-flex items-center justify-center w-8 h-8 rounded-full bg-gray-100"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})])],-1)])),_:2},1032,["to"])])]))),128))])])]),h(u,{"current-page":x.value,"onUpdate:currentPage":t[3]||(t[3]=r=>x.value=r),"total-items":I.value,"per-page":$.value},null,8,["current-page","total-items","per-page"])]))])}}};export{xe as default};
