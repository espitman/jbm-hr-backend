import{j as C,k as V,r as f,s as P,c as d,o as u,a as e,b as k,t as w,x as D,w as j,d as T,F as I,n as h,y as Y,v as $,m as A,z as q,A as E,q as H,B as z,C as L,D as R}from"./FE44vmqp.js";import{_ as B}from"./CxlkBo9E.js";import{_ as G}from"./CHlyBG-p.js";import{D as J}from"./BdlHV4-s.js";const K={class:"bg-white rounded-lg shadow p-6 flex flex-col items-center"},Q=["src"],W={key:1,class:"h-full w-full flex items-center justify-center bg-gray-200"},X={class:"text-gray-500 text-4xl"},Z={class:"text-lg font-semibold mt-4"},ee={class:"text-sm text-gray-500"},te={class:"w-full mt-6 space-y-2 text-sm"},se={class:"flex justify-between items-center"},ae={class:"flex items-center gap-2"},oe={class:"text-gray-900"},re={class:"flex justify-between items-center"},le={class:"flex items-center gap-2"},ne={class:"text-gray-900"},ie={class:"p-4"},de={class:"flex justify-end gap-2"},ue=["disabled"],pe=["disabled"],ce={key:0,class:"flex items-center gap-2"},me={key:1},fe={__name:"ProfileCard",props:{avatar:{type:String,default:void 0},name:{type:String,default:"کاربر"},role:{type:String,default:"کارمند"},userId:{type:String,required:!0},birthdate:{type:String,default:void 0},cooperation_start_date:{type:String,default:void 0}},emits:["update:avatar","success","update:birthdate","update:cooperation_start_date"],setup(i,{emit:_}){const{$api:x,$formatDateOnly:r}=C(),v=i,s=_,a=V(),p=f(!1),b=f(!1),l=f(null),m=f(null),y=f(!1),o=P(()=>m.value==="birthdate"?"تغییر تاریخ تولد":"تغییر تاریخ شروع همکاری"),t=()=>{p.value=!0},c=()=>{p.value=!1},S=g=>{m.value=g,l.value=v[g]||"",b.value=!0},U=()=>{b.value=!1,m.value=null,l.value=null},N=async()=>{try{y.value=!0;const g=m.value==="birthdate"?`/api/v1/admin/users/${v.userId}/birthdate`:`/api/v1/admin/users/${v.userId}/cooperation-start-date`;await x.put(g,{[m.value]:l.value}),s(`update:${m.value}`,l.value),s("success"),U(),a.success("تاریخ با موفقیت بروزرسانی شد")}catch{a.error("خطا در بروزرسانی تاریخ")}finally{y.value=!1}},F=async g=>{try{await x.put(`/api/v1/admin/users/${v.userId}/avatar`,{avatar:g}),s("update:avatar",g),s("success"),c()}catch{a.error("خطا در بروزرسانی تصویر پروفایل")}},O=g=>{const n=g.split(" ");return n.length>=2?`${n[0][0]}${n[1][0]}`:g[0]};return(g,n)=>(u(),d(I,null,[e("div",K,[e("div",{class:"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow cursor-pointer",onClick:t},[i.avatar?(u(),d("img",{key:0,class:"w-full h-full object-cover",src:i.avatar,alt:"User Avatar"},null,8,Q)):(u(),d("div",W,[e("span",X,w(O(i.name)),1)]))]),e("div",Z,w(i.name),1),e("div",ee,w(i.role),1),e("div",te,[e("div",se,[n[4]||(n[4]=e("span",{class:"text-gray-500"},"تاریخ تولد:",-1)),e("div",ae,[e("span",oe,w(D(r)(i.birthdate)),1),e("button",{onClick:n[0]||(n[0]=M=>S("birthdate")),class:"text-purple-600 hover:text-purple-700"},n[3]||(n[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]))])]),e("div",re,[n[6]||(n[6]=e("span",{class:"text-gray-500"},"تاریخ شروع همکاری:",-1)),e("div",le,[e("span",ne,w(D(r)(i.cooperation_start_date)),1),e("button",{onClick:n[1]||(n[1]=M=>S("cooperation_start_date")),class:"text-purple-600 hover:text-purple-700"},n[5]||(n[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]))])])])]),k(B,{"is-open":p.value,title:"تغییر تصویر پروفایل",size:"md","show-cancel-button":!1,"show-footer":!1,onClose:c},{default:j(()=>[k(G,{dir:"avatars",onUploaded:F})]),_:1},8,["is-open"]),k(B,{"is-open":b.value,title:o.value,size:"sm",onClose:U},{footer:j(()=>[e("div",de,[e("button",{onClick:U,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",disabled:y.value}," انصراف ",8,ue),e("button",{onClick:N,class:"px-4 py-2 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:y.value},[y.value?(u(),d("span",ce,n[7]||(n[7]=[e("svg",{class:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),T(" در حال ذخیره... ")]))):(u(),d("span",me,"ذخیره"))],8,pe)])]),default:j(()=>[e("div",ie,[k(D(J),{modelValue:l.value,"onUpdate:modelValue":n[2]||(n[2]=M=>l.value=M),format:"YYYY-MM-DD","display-format":"jYYYY-jMM-jDD",editable:!1,"auto-submit":!1,"input-class":"w-full px-3 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,8,["modelValue"])])]),_:1},8,["is-open","title"])],64))}},ve={class:"bg-white rounded-lg shadow p-6 flex flex-col items-center"},be=["disabled"],ge=["disabled"],ye={class:"flex gap-2 mt-2"},xe=["disabled"],he={key:0,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white inline-block mr-2"},we={key:1},_e=["disabled"],ke={key:0,class:"text-xs text-gray-500 text-center mt-2"},$e={__name:"EditPasswordCard",props:{role:{type:String,default:"employee"},userId:{type:[String,Number],required:!0}},emits:["updated"],setup(i,{emit:_}){const x=i,r=_,{$api:v}=C(),s=V(),a=f({password:"",password_confirmation:""}),p=f(!1),b=f(null),l=()=>{a.value={password:"",password_confirmation:""}},m=async()=>{try{if(p.value=!0,b.value=null,a.value.password!==a.value.password_confirmation){s.error("رمز عبور و تکرار آن مطابقت ندارند"),p.value=!1;return}await v.put(`/api/v1/admin/users/${x.userId}/password`,a.value),s.success("رمز عبور با موفقیت بروزرسانی شد"),l(),r("updated")}catch(y){b.value=y.message||"خطا در بروزرسانی رمز عبور",s.error(b.value)}finally{p.value=!1}};return(y,o)=>(u(),d("div",ve,[o[2]||(o[2]=e("div",{class:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4 border-4 border-white shadow"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})])],-1)),o[3]||(o[3]=e("div",{class:"text-sm font-medium mb-4"},"تغییر رمز عبور",-1)),e("form",{class:q(["w-full space-y-3",{"opacity-50 pointer-events-none":i.role!=="admin"}]),onSubmit:A(m,["prevent"])},[h(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>a.value.password=t),type:"password",placeholder:"رمز عبور جدید",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm placeholder:text-right",disabled:i.role!=="admin",dir:"ltr"},null,8,be),[[$,a.value.password]]),h(e("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>a.value.password_confirmation=t),type:"password",placeholder:"تکرار رمز عبور جدید",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm placeholder:text-right",disabled:i.role!=="admin",dir:"ltr"},null,8,ge),[[$,a.value.password_confirmation]]),e("div",ye,[e("button",{type:"submit",class:"flex-1 bg-green-500 text-white py-2 rounded cursor-pointer flex items-center justify-center",disabled:i.role!=="admin"||p.value},[p.value?(u(),d("span",he)):(u(),d("span",we,"بروزرسانی"))],8,xe),e("button",{type:"button",class:"flex-1 bg-red-400 text-white py-2 rounded cursor-pointer",disabled:i.role!=="admin"||p.value,onClick:l}," انصراف ",8,_e)]),i.role!=="admin"?(u(),d("p",ke,"امکان ست کردن رمز عبور فقط برای رول ادمین است.")):Y("",!0)],34)]))}},Ce={class:"bg-white rounded-lg shadow p-6"},Ue=["value"],Me={class:"pt-2"},De=["disabled"],je={key:0,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"},Ve={key:1},Se={key:0,class:"text-red-600 text-sm text-center bg-red-50 py-2 px-4 rounded-lg"},ze={__name:"EditProfileForm",props:{user:{type:Object,default:()=>({id:null,email:"",phone:"",role:"employee",first_name:"",last_name:"",department_id:""})}},emits:["updated"],setup(i,{emit:_}){const x=i,{$api:r}=C(),v=V(),s=f({email:"",phone:"",role:"employee",first_name:"",last_name:"",department_id:""}),a=f(!1),p=f(null),b=f([]),l=_;E(()=>x.user,o=>{var t;o&&(s.value={email:o.email,phone:o.phone,role:o.role,first_name:o.first_name,last_name:o.last_name,department_id:((t=o.department)==null?void 0:t.id)||""})},{immediate:!0});const m=async()=>{try{a.value=!0;const o=await r.get("/api/v1/departments");b.value=o.data.departments||[]}catch{v.error("خطا در دریافت لیست دپارتمان‌ها")}finally{a.value=!1}},y=async()=>{try{a.value=!0,p.value=null,await r.put(`/api/v1/admin/users/${x.user.id}`,s.value),v.success("پروفایل با موفقیت بروزرسانی شد"),l("updated")}catch(o){p.value=o.message||"خطا در بروزرسانی پروفایل",v.error(p.value)}finally{a.value=!1}};return H(()=>{m()}),(o,t)=>(u(),d("div",Ce,[t[14]||(t[14]=e("h2",{class:"text-lg font-bold mb-4"},"ویرایش پروفایل",-1)),e("form",{class:"space-y-6",onSubmit:A(y,["prevent"])},[e("div",null,[t[6]||(t[6]=e("label",{for:"first_name",class:"block text-sm font-medium text-gray-700 mb-1"},"نام",-1)),h(e("input",{id:"first_name","onUpdate:modelValue":t[0]||(t[0]=c=>s.value.first_name=c),type:"text",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[$,s.value.first_name]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"last_name",class:"block text-sm font-medium text-gray-700 mb-1"},"نام خانوادگی",-1)),h(e("input",{id:"last_name","onUpdate:modelValue":t[1]||(t[1]=c=>s.value.last_name=c),type:"text",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[$,s.value.last_name]])]),e("div",null,[t[8]||(t[8]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-1"},"ایمیل",-1)),h(e("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=c=>s.value.email=c),type:"email",dir:"ltr",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[$,s.value.email]])]),e("div",null,[t[9]||(t[9]=e("label",{for:"phone",class:"block text-sm font-medium text-gray-700 mb-1"},"شماره موبایل",-1)),h(e("input",{id:"phone","onUpdate:modelValue":t[3]||(t[3]=c=>s.value.phone=c),type:"tel",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[$,s.value.phone]])]),e("div",null,[t[11]||(t[11]=e("label",{for:"role",class:"block text-sm font-medium text-gray-700 mb-1"},"نقش",-1)),h(e("select",{id:"role","onUpdate:modelValue":t[4]||(t[4]=c=>s.value.role=c),class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},t[10]||(t[10]=[e("option",{value:"admin"},"مدیر",-1),e("option",{value:"employee"},"کارمند",-1)]),512),[[z,s.value.role]])]),e("div",null,[t[13]||(t[13]=e("label",{for:"department_id",class:"block text-sm font-medium text-gray-700 mb-1"},"دپارتمان",-1)),h(e("select",{id:"department_id","onUpdate:modelValue":t[5]||(t[5]=c=>s.value.department_id=c),class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},[t[12]||(t[12]=e("option",{value:""},"انتخاب دپارتمان",-1)),(u(!0),d(I,null,L(b.value,c=>(u(),d("option",{key:c.id,value:c.id},w(c.title),9,Ue))),128))],512),[[z,s.value.department_id]])]),e("div",Me,[e("button",{type:"submit",class:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors cursor-pointer",disabled:a.value},[a.value?(u(),d("span",je)):(u(),d("span",Ve,"بروزرسانی"))],8,De)]),p.value?(u(),d("div",Se,w(p.value),1)):Y("",!0)],32)]))}},Be={class:"container mx-auto p-1"},Ie={key:0,class:"flex justify-center items-center h-64"},Ye={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},Ae={class:"block sm:inline"},He={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Ne={class:"col-span-1 space-y-6"},Fe={class:"col-span-2"},Ee={__name:"[id]",setup(i){const _=R(),{$api:x}=C(),r=f({}),v=f(!0),s=f(null),a=async()=>{try{v.value=!0,s.value=null;const l=await x.get(`/api/v1/admin/users/${_.params.id}`);r.value=l.data||{}}catch(l){s.value=l.message||"خطا در دریافت اطلاعات کاربر"}finally{v.value=!1}},p=l=>{r.value.birthdate=l},b=l=>{r.value.cooperation_start_date=l};return H(()=>{a()}),(l,m)=>(u(),d("div",Be,[m[1]||(m[1]=e("h1",{class:"text-xl font-bold text-purple-700 mb-6"},"ویرایش پروفایل",-1)),v.value?(u(),d("div",Ie,m[0]||(m[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-700"},null,-1)]))):s.value?(u(),d("div",Ye,[e("span",Ae,w(s.value),1)])):(u(),d("div",He,[e("div",Ne,[k(fe,{avatar:r.value.avatar,name:r.value.first_name+" "+r.value.last_name,role:r.value.role==="admin"?"مدیر":"کارمند",userId:r.value.id,birthdate:r.value.birthdate,cooperation_start_date:r.value.cooperation_start_date,"onUpdate:avatar":l.handleAvatarUpdate,"onUpdate:birthdate":p,"onUpdate:cooperation_start_date":b,onSuccess:a},null,8,["avatar","name","role","userId","birthdate","cooperation_start_date","onUpdate:avatar"]),k($e,{role:r.value.role,"user-id":r.value.id,onUpdated:a},null,8,["role","user-id"])]),e("div",Fe,[k(ze,{user:r.value,onUpdated:a},null,8,["user"])])]))]))}};export{Ee as default};
