import{j as $,k as C,r as v,c as l,o as n,s as S,m as j,a as e,g as V,t as k,b as _,w as I,F as M,n as x,v as w,x as F,y as z,z as N,A as B,q as P}from"./DUgZ_HYD.js";import{_ as A}from"./CHBYFvnx.js";const D={class:"space-y-4"},L={key:1,class:"flex justify-center items-center py-12"},q={key:2,class:"mt-4"},E=["src"],G={key:3,class:"text-red-600 text-sm text-center bg-red-50 py-2 px-4 rounded-lg"},O={__name:"ImageUpload",props:{dir:{type:String,required:!0}},emits:["uploaded"],setup(i,{emit:b}){const{$api:f}=$(),d=C(),m=v(null),a=v(null),s=v(null),r=v(!1),p=b,y=i,u=()=>{m.value.click()},t=g=>{const c=g.target.files[0];c&&h(c)},o=g=>{const c=g.dataTransfer.files[0];c&&h(c)},h=async g=>{var c;if(s.value=null,a.value=null,r.value=!0,!g.type.startsWith("image/")){s.value="لطفا یک فایل تصویر انتخاب کنید",r.value=!1;return}if(g.size>10*1024*1024){s.value="حجم فایل نباید بیشتر از 10 مگابایت باشد",r.value=!1;return}a.value=URL.createObjectURL(g);try{const U=await f.upload(`/api/v1/upload/image/public/${y.dir}`,g);if((c=U.data)!=null&&c.url)p("uploaded",U.data.url);else throw new Error("خطا در آپلود تصویر")}catch(U){s.value=U.message||"خطا در آپلود تصویر",d.error("خطا در آپلود تصویر")}finally{r.value=!1}};return(g,c)=>(n(),l("div",D,[r.value?(n(),l("div",L,c[2]||(c[2]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"},null,-1)]))):(n(),l("div",{key:0,class:"relative border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition-colors",onDragover:c[0]||(c[0]=j(()=>{},["prevent"])),onDrop:j(o,["prevent"]),onClick:u},[e("input",{ref_key:"fileInput",ref:m,type:"file",class:"hidden",accept:"image/*",onChange:t},null,544),c[1]||(c[1]=V('<div class="space-y-2"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><div class="flex flex-col items-center text-sm text-gray-600"><label class="relative cursor-pointer rounded-md font-medium text-purple-600 hover:text-purple-500"><span>آپلود تصویر</span></label><p class="mt-1">یا فایل را بکشید و رها کنید</p></div><p class="text-xs text-gray-500 text-center">PNG, JPG, GIF تا 10MB</p></div>',1))],32)),a.value?(n(),l("div",q,[e("img",{src:a.value,class:"max-h-48 rounded-lg mx-auto",alt:"Preview"},null,8,E)])):S("",!0),s.value?(n(),l("div",G,k(s.value),1)):S("",!0)]))}},R={class:"bg-white rounded-lg shadow p-6 flex flex-col items-center"},T=["src"],H={class:"text-lg font-semibold"},J={class:"text-sm text-gray-500"},W={__name:"ProfileCard",props:{avatar:{type:String,default:"https://randomuser.me/api/portraits/men/1.jpg"},name:{type:String,default:"کاربر"},role:{type:String,default:"کارمند"},userId:{type:String,required:!0}},emits:["update:avatar","success"],setup(i,{emit:b}){const{$api:f}=$(),d=i,m=b,a=C(),s=v(!1),r=()=>{s.value=!0},p=()=>{s.value=!1},y=async u=>{try{await f.put(`/api/v1/admin/users/${d.userId}/avatar`,{avatar:u}),m("update:avatar",u),m("success"),p()}catch{a.error("خطا در بروزرسانی تصویر پروفایل")}};return(u,t)=>(n(),l(M,null,[e("div",R,[e("img",{class:"w-24 h-24 rounded-full object-cover mb-4 border-4 border-white shadow cursor-pointer",src:i.avatar||"https://randomuser.me/api/portraits/men/1.jpg",alt:"User Avatar",onClick:r},null,8,T),e("div",H,k(i.name),1),e("div",J,k(i.role),1)]),_(A,{"is-open":s.value,title:"تغییر تصویر پروفایل",size:"md","show-cancel-button":!1,"show-footer":!1,onClose:p},{default:I(()=>[_(O,{dir:"avatars",onUploaded:y})]),_:1},8,["is-open"])],64))}},K={class:"bg-white rounded-lg shadow p-6 flex flex-col items-center"},Q=["disabled"],X=["disabled"],Y={class:"flex gap-2 mt-2"},Z=["disabled"],ee={key:0,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white inline-block mr-2"},te={key:1},se=["disabled"],ae={key:0,class:"text-xs text-gray-500 text-center mt-2"},re={__name:"EditPasswordCard",props:{role:{type:String,default:"employee"},userId:{type:[String,Number],required:!0}},emits:["updated"],setup(i,{emit:b}){const f=i,d=b,{$api:m}=$(),a=C(),s=v({password:"",password_confirmation:""}),r=v(!1),p=v(null),y=()=>{s.value={password:"",password_confirmation:""}},u=async()=>{try{if(r.value=!0,p.value=null,s.value.password!==s.value.password_confirmation){a.error("رمز عبور و تکرار آن مطابقت ندارند"),r.value=!1;return}await m.put(`/api/v1/admin/users/${f.userId}/password`,s.value),a.success("رمز عبور با موفقیت بروزرسانی شد"),y(),d("updated")}catch(t){p.value=t.message||"خطا در بروزرسانی رمز عبور",a.error(p.value)}finally{r.value=!1}};return(t,o)=>(n(),l("div",K,[o[2]||(o[2]=e("div",{class:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4 border-4 border-white shadow"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})])],-1)),o[3]||(o[3]=e("div",{class:"text-sm font-medium mb-4"},"تغییر رمز عبور",-1)),e("form",{class:F(["w-full space-y-3",{"opacity-50 pointer-events-none":i.role!=="admin"}]),onSubmit:j(u,["prevent"])},[x(e("input",{"onUpdate:modelValue":o[0]||(o[0]=h=>s.value.password=h),type:"password",placeholder:"رمز عبور جدید",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm placeholder:text-right",disabled:i.role!=="admin",dir:"ltr"},null,8,Q),[[w,s.value.password]]),x(e("input",{"onUpdate:modelValue":o[1]||(o[1]=h=>s.value.password_confirmation=h),type:"password",placeholder:"تکرار رمز عبور جدید",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm placeholder:text-right",disabled:i.role!=="admin",dir:"ltr"},null,8,X),[[w,s.value.password_confirmation]]),e("div",Y,[e("button",{type:"submit",class:"flex-1 bg-green-500 text-white py-2 rounded cursor-pointer flex items-center justify-center",disabled:i.role!=="admin"||r.value},[r.value?(n(),l("span",ee)):(n(),l("span",te,"بروزرسانی"))],8,Z),e("button",{type:"button",class:"flex-1 bg-red-400 text-white py-2 rounded cursor-pointer",disabled:i.role!=="admin"||r.value,onClick:y}," انصراف ",8,se)]),i.role!=="admin"?(n(),l("p",ae,"امکان ست کردن رمز عبور فقط برای رول ادمین است.")):S("",!0)],34)]))}},oe={class:"bg-white rounded-lg shadow p-6"},le={class:"pt-2"},ne=["disabled"],ie={key:0,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"},de={key:1},ue={key:0,class:"text-red-600 text-sm text-center bg-red-50 py-2 px-4 rounded-lg"},pe={__name:"EditProfileForm",props:{user:{type:Object,default:()=>({id:null,email:"",phone:"",role:"employee",first_name:"",last_name:""})}},emits:["updated"],setup(i,{emit:b}){const f=i,{$api:d}=$(),m=C(),a=v({email:"",phone:"",role:"employee",first_name:"",last_name:""}),s=v(!1),r=v(null),p=b;z(()=>f.user,u=>{u&&(a.value={email:u.email,phone:u.phone,role:u.role,first_name:u.first_name,last_name:u.last_name})},{immediate:!0});const y=async()=>{try{s.value=!0,r.value=null,await d.put(`/api/v1/admin/users/${f.user.id}`,a.value),m.success("پروفایل با موفقیت بروزرسانی شد"),p("updated")}catch(u){r.value=u.message||"خطا در بروزرسانی پروفایل",m.error(r.value)}finally{s.value=!1}};return(u,t)=>(n(),l("div",oe,[t[11]||(t[11]=e("h2",{class:"text-lg font-bold mb-4"},"ویرایش پروفایل",-1)),e("form",{class:"space-y-6",onSubmit:j(y,["prevent"])},[e("div",null,[t[5]||(t[5]=e("label",{for:"first_name",class:"block text-sm font-medium text-gray-700 mb-1"},"نام",-1)),x(e("input",{id:"first_name","onUpdate:modelValue":t[0]||(t[0]=o=>a.value.first_name=o),type:"text",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[w,a.value.first_name]])]),e("div",null,[t[6]||(t[6]=e("label",{for:"last_name",class:"block text-sm font-medium text-gray-700 mb-1"},"نام خانوادگی",-1)),x(e("input",{id:"last_name","onUpdate:modelValue":t[1]||(t[1]=o=>a.value.last_name=o),type:"text",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[w,a.value.last_name]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-1"},"ایمیل",-1)),x(e("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=o=>a.value.email=o),type:"email",dir:"ltr",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[w,a.value.email]])]),e("div",null,[t[8]||(t[8]=e("label",{for:"phone",class:"block text-sm font-medium text-gray-700 mb-1"},"شماره موبایل",-1)),x(e("input",{id:"phone","onUpdate:modelValue":t[3]||(t[3]=o=>a.value.phone=o),type:"tel",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[w,a.value.phone]])]),e("div",null,[t[10]||(t[10]=e("label",{for:"role",class:"block text-sm font-medium text-gray-700 mb-1"},"نقش",-1)),x(e("select",{id:"role","onUpdate:modelValue":t[4]||(t[4]=o=>a.value.role=o),class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},t[9]||(t[9]=[e("option",{value:"admin"},"مدیر",-1),e("option",{value:"employee"},"کارمند",-1)]),512),[[N,a.value.role]])]),e("div",le,[e("button",{type:"submit",class:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors cursor-pointer",disabled:s.value},[s.value?(n(),l("span",ie)):(n(),l("span",de,"بروزرسانی"))],8,ne)]),r.value?(n(),l("div",ue,k(r.value),1)):S("",!0)],32)]))}},ce={class:"container mx-auto p-1"},me={key:0,class:"flex justify-center items-center h-64"},ve={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},fe={class:"block sm:inline"},be={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ge={class:"col-span-1 space-y-6"},ye={class:"col-span-2"},we={__name:"[id]",setup(i){const b=B(),{$api:f}=$(),d=v({}),m=v(!0),a=v(null),s=async()=>{try{m.value=!0,a.value=null;const r=await f.get(`/api/v1/admin/users/${b.params.id}`);d.value=r.data||{}}catch(r){a.value=r.message||"خطا در دریافت اطلاعات کاربر"}finally{m.value=!1}};return P(()=>{s()}),(r,p)=>(n(),l("div",ce,[p[1]||(p[1]=e("h1",{class:"text-xl font-bold text-purple-700 mb-6"},"ویرایش پروفایل",-1)),m.value?(n(),l("div",me,p[0]||(p[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-700"},null,-1)]))):a.value?(n(),l("div",ve,[e("span",fe,k(a.value),1)])):(n(),l("div",be,[e("div",ge,[_(W,{avatar:d.value.avatar,name:d.value.first_name+" "+d.value.last_name,role:d.value.role==="admin"?"مدیر":"کارمند",userId:d.value.id,"onUpdate:avatar":r.handleAvatarUpdate,onSuccess:s},null,8,["avatar","name","role","userId","onUpdate:avatar"]),_(re,{role:d.value.role,"user-id":d.value.id,onUpdated:s},null,8,["role","user-id"])]),e("div",ye,[_(pe,{user:d.value,onUpdated:s},null,8,["user"])])]))]))}};export{we as default};
