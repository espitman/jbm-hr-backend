import{j as w,k as $,r as m,c as d,o as i,a as e,b as x,t as h,w as S,F as V,n as b,s as k,v as y,m as U,x as j,y as C,z as M,A as I,q as z}from"./BJEvtXCT.js";import{_ as A}from"./qQdQVG1-.js";import{_ as N}from"./DfrOUCg1.js";const B={class:"bg-white rounded-lg shadow p-6 flex flex-col items-center"},F=["src"],q={key:1,class:"h-full w-full flex items-center justify-center bg-gray-200"},E={class:"text-gray-500 text-4xl"},P={class:"text-lg font-semibold mt-4"},D={class:"text-sm text-gray-500"},O={__name:"ProfileCard",props:{avatar:{type:String,default:void 0},name:{type:String,default:"کاربر"},role:{type:String,default:"کارمند"},userId:{type:String,required:!0}},emits:["update:avatar","success"],setup(r,{emit:v}){const{$api:f}=w(),n=r,p=v,s=$(),a=m(!1),l=()=>{a.value=!0},u=()=>{a.value=!1},g=async t=>{try{await f.put(`/api/v1/admin/users/${n.userId}/avatar`,{avatar:t}),p("update:avatar",t),p("success"),u()}catch{s.error("خطا در بروزرسانی تصویر پروفایل")}},c=t=>{const o=t.split(" ");return o.length>=2?`${o[0][0]}${o[1][0]}`:t[0]};return(t,o)=>(i(),d(V,null,[e("div",B,[e("div",{class:"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow cursor-pointer",onClick:l},[r.avatar?(i(),d("img",{key:0,class:"w-full h-full object-cover",src:r.avatar,alt:"User Avatar"},null,8,F)):(i(),d("div",q,[e("span",E,h(c(r.name)),1)]))]),e("div",P,h(r.name),1),e("div",D,h(r.role),1)]),x(A,{"is-open":a.value,title:"تغییر تصویر پروفایل",size:"md","show-cancel-button":!1,"show-footer":!1,onClose:u},{default:S(()=>[x(N,{dir:"avatars",onUploaded:g})]),_:1},8,["is-open"])],64))}},T={class:"bg-white rounded-lg shadow p-6 flex flex-col items-center"},H=["disabled"],R=["disabled"],G={class:"flex gap-2 mt-2"},J=["disabled"],K={key:0,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white inline-block mr-2"},L={key:1},Q=["disabled"],W={key:0,class:"text-xs text-gray-500 text-center mt-2"},X={__name:"EditPasswordCard",props:{role:{type:String,default:"employee"},userId:{type:[String,Number],required:!0}},emits:["updated"],setup(r,{emit:v}){const f=r,n=v,{$api:p}=w(),s=$(),a=m({password:"",password_confirmation:""}),l=m(!1),u=m(null),g=()=>{a.value={password:"",password_confirmation:""}},c=async()=>{try{if(l.value=!0,u.value=null,a.value.password!==a.value.password_confirmation){s.error("رمز عبور و تکرار آن مطابقت ندارند"),l.value=!1;return}await p.put(`/api/v1/admin/users/${f.userId}/password`,a.value),s.success("رمز عبور با موفقیت بروزرسانی شد"),g(),n("updated")}catch(t){u.value=t.message||"خطا در بروزرسانی رمز عبور",s.error(u.value)}finally{l.value=!1}};return(t,o)=>(i(),d("div",T,[o[2]||(o[2]=e("div",{class:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4 border-4 border-white shadow"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})])],-1)),o[3]||(o[3]=e("div",{class:"text-sm font-medium mb-4"},"تغییر رمز عبور",-1)),e("form",{class:j(["w-full space-y-3",{"opacity-50 pointer-events-none":r.role!=="admin"}]),onSubmit:U(c,["prevent"])},[b(e("input",{"onUpdate:modelValue":o[0]||(o[0]=_=>a.value.password=_),type:"password",placeholder:"رمز عبور جدید",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm placeholder:text-right",disabled:r.role!=="admin",dir:"ltr"},null,8,H),[[y,a.value.password]]),b(e("input",{"onUpdate:modelValue":o[1]||(o[1]=_=>a.value.password_confirmation=_),type:"password",placeholder:"تکرار رمز عبور جدید",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm placeholder:text-right",disabled:r.role!=="admin",dir:"ltr"},null,8,R),[[y,a.value.password_confirmation]]),e("div",G,[e("button",{type:"submit",class:"flex-1 bg-green-500 text-white py-2 rounded cursor-pointer flex items-center justify-center",disabled:r.role!=="admin"||l.value},[l.value?(i(),d("span",K)):(i(),d("span",L,"بروزرسانی"))],8,J),e("button",{type:"button",class:"flex-1 bg-red-400 text-white py-2 rounded cursor-pointer",disabled:r.role!=="admin"||l.value,onClick:g}," انصراف ",8,Q)]),r.role!=="admin"?(i(),d("p",W,"امکان ست کردن رمز عبور فقط برای رول ادمین است.")):k("",!0)],34)]))}},Y={class:"bg-white rounded-lg shadow p-6"},Z={class:"pt-2"},ee=["disabled"],te={key:0,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"},se={key:1},oe={key:0,class:"text-red-600 text-sm text-center bg-red-50 py-2 px-4 rounded-lg"},ae={__name:"EditProfileForm",props:{user:{type:Object,default:()=>({id:null,email:"",phone:"",role:"employee",first_name:"",last_name:""})}},emits:["updated"],setup(r,{emit:v}){const f=r,{$api:n}=w(),p=$(),s=m({email:"",phone:"",role:"employee",first_name:"",last_name:""}),a=m(!1),l=m(null),u=v;C(()=>f.user,c=>{c&&(s.value={email:c.email,phone:c.phone,role:c.role,first_name:c.first_name,last_name:c.last_name})},{immediate:!0});const g=async()=>{try{a.value=!0,l.value=null,await n.put(`/api/v1/admin/users/${f.user.id}`,s.value),p.success("پروفایل با موفقیت بروزرسانی شد"),u("updated")}catch(c){l.value=c.message||"خطا در بروزرسانی پروفایل",p.error(l.value)}finally{a.value=!1}};return(c,t)=>(i(),d("div",Y,[t[11]||(t[11]=e("h2",{class:"text-lg font-bold mb-4"},"ویرایش پروفایل",-1)),e("form",{class:"space-y-6",onSubmit:U(g,["prevent"])},[e("div",null,[t[5]||(t[5]=e("label",{for:"first_name",class:"block text-sm font-medium text-gray-700 mb-1"},"نام",-1)),b(e("input",{id:"first_name","onUpdate:modelValue":t[0]||(t[0]=o=>s.value.first_name=o),type:"text",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[y,s.value.first_name]])]),e("div",null,[t[6]||(t[6]=e("label",{for:"last_name",class:"block text-sm font-medium text-gray-700 mb-1"},"نام خانوادگی",-1)),b(e("input",{id:"last_name","onUpdate:modelValue":t[1]||(t[1]=o=>s.value.last_name=o),type:"text",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[y,s.value.last_name]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-1"},"ایمیل",-1)),b(e("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=o=>s.value.email=o),type:"email",dir:"ltr",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[y,s.value.email]])]),e("div",null,[t[8]||(t[8]=e("label",{for:"phone",class:"block text-sm font-medium text-gray-700 mb-1"},"شماره موبایل",-1)),b(e("input",{id:"phone","onUpdate:modelValue":t[3]||(t[3]=o=>s.value.phone=o),type:"tel",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[y,s.value.phone]])]),e("div",null,[t[10]||(t[10]=e("label",{for:"role",class:"block text-sm font-medium text-gray-700 mb-1"},"نقش",-1)),b(e("select",{id:"role","onUpdate:modelValue":t[4]||(t[4]=o=>s.value.role=o),class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},t[9]||(t[9]=[e("option",{value:"admin"},"مدیر",-1),e("option",{value:"employee"},"کارمند",-1)]),512),[[M,s.value.role]])]),e("div",Z,[e("button",{type:"submit",class:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors cursor-pointer",disabled:a.value},[a.value?(i(),d("span",te)):(i(),d("span",se,"بروزرسانی"))],8,ee)]),l.value?(i(),d("div",oe,h(l.value),1)):k("",!0)],32)]))}},le={class:"container mx-auto p-1"},re={key:0,class:"flex justify-center items-center h-64"},ne={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},de={class:"block sm:inline"},ie={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ue={class:"col-span-1 space-y-6"},ce={class:"col-span-2"},ve={__name:"[id]",setup(r){const v=I(),{$api:f}=w(),n=m({}),p=m(!0),s=m(null),a=async()=>{try{p.value=!0,s.value=null;const l=await f.get(`/api/v1/admin/users/${v.params.id}`);n.value=l.data||{}}catch(l){s.value=l.message||"خطا در دریافت اطلاعات کاربر"}finally{p.value=!1}};return z(()=>{a()}),(l,u)=>(i(),d("div",le,[u[1]||(u[1]=e("h1",{class:"text-xl font-bold text-purple-700 mb-6"},"ویرایش پروفایل",-1)),p.value?(i(),d("div",re,u[0]||(u[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-700"},null,-1)]))):s.value?(i(),d("div",ne,[e("span",de,h(s.value),1)])):(i(),d("div",ie,[e("div",ue,[x(O,{avatar:n.value.avatar,name:n.value.first_name+" "+n.value.last_name,role:n.value.role==="admin"?"مدیر":"کارمند",userId:n.value.id,"onUpdate:avatar":l.handleAvatarUpdate,onSuccess:a},null,8,["avatar","name","role","userId","onUpdate:avatar"]),x(X,{role:n.value.role,"user-id":n.value.id,onUpdated:a},null,8,["role","user-id"])]),e("div",ce,[x(ae,{user:n.value,onUpdated:a},null,8,["user"])])]))]))}};export{ve as default};
