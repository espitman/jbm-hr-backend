import{g as B,q as V,r as u,H as S,o as l,w as T,a as e,v as z,x as _,y as D,C as N,c as p,d as j,D as A,G as P,B as k,k as U,b as $,t as c,F as E,m as F,A as H,n as C}from"./CSPX8tqz.js";import{_ as O}from"./CVi9GnK4.js";import{_ as R}from"./D5qjO65t.js";const G={class:"flex justify-end space-x-3 mt-6"},I=["disabled"],L={key:0,class:"inline-flex items-center"},J={key:1},K={__name:"CreateCodeModal",props:{isOpen:{type:Boolean,required:!0}},emits:["close","created"],setup(v,{emit:f}){const g=f,{$api:x}=B(),y=V(),d=u(!1),r=u({code:"",type:"1m"}),m=async()=>{try{d.value=!0,await x.post("/api/v1/admin/alibaba-codes",r.value),y.success("کد با موفقیت ایجاد شد"),g("created"),g("close"),r.value={code:"",type:"1m"}}catch(n){console.error("Error creating code:",n),y.error(n.message||"خطا در ایجاد کد")}finally{d.value=!1}};return(n,t)=>(l(),S(O,{"is-open":v.isOpen,title:"ایجاد کد جدید",onClose:t[3]||(t[3]=i=>n.$emit("close")),"show-cancel-button":!1,"show-footer":!1},{default:T(()=>[e("form",{onSubmit:z(m,["prevent"]),class:"space-y-4"},[e("div",null,[t[4]||(t[4]=e("label",{for:"code",class:"block text-sm font-medium text-gray-700 mb-1"},"کد",-1)),_(e("input",{id:"code","onUpdate:modelValue":t[0]||(t[0]=i=>r.value.code=i),type:"text",class:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors",required:""},null,512),[[D,r.value.code]])]),e("div",null,[t[6]||(t[6]=e("label",{for:"type",class:"block text-sm font-medium text-gray-700 mb-1"},"نوع",-1)),_(e("select",{id:"type","onUpdate:modelValue":t[1]||(t[1]=i=>r.value.type=i),class:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors",required:""},t[5]||(t[5]=[e("option",{value:"1m"},"۱ میلیونی",-1),e("option",{value:"3m"},"۳ میلیونی",-1),e("option",{value:"6m"},"۶ میلیونی",-1),e("option",{value:"12m"},"۱۲ میلیونی",-1),e("option",{value:"25m"},"۲۵ میلیونی",-1)]),512),[[N,r.value.type]])]),e("div",G,[e("button",{type:"button",onClick:t[2]||(t[2]=i=>n.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors"}," انصراف "),e("button",{type:"submit",disabled:d.value,class:"px-4 py-2 text-sm font-medium text-white bg-purple-600 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[d.value?(l(),p("span",L,t[7]||(t[7]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),j(" در حال ثبت... ")]))):(l(),p("span",J,"ثبت"))],8,I)])],32)]),_:1},8,["is-open"]))}},W={class:"container mx-auto p-0"},X={class:"flex items-center justify-between mb-6"},Y={key:0,class:"flex justify-center items-center py-8"},Z={key:1,class:"text-center text-red-500"},Q={key:2},ee={class:"bg-white shadow-md rounded-lg overflow-hidden"},te={class:"min-w-full divide-y divide-gray-200"},se={class:"bg-white divide-y divide-gray-200"},oe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},re={class:"px-6 py-4 whitespace-nowrap text-sm"},ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},q=10,ce={__name:"list",setup(v){const{$api:f,$formatDate:g}=B(),x=A(),y=P(),d=u([]),r=u(!0),m=u(null),n=u(!1),t=u(1),i=u(0),M=a=>({"1m":"۱ میلیونی","3m":"۳ میلیونی","6m":"۶ میلیونی","12m":"۱۲ میلیونی","25m":"۲۵ میلیونی"})[a]||a,b=async(a=1)=>{try{r.value=!0,m.value=null;const s={page:a,page_size:q},o=await f.get("/api/v1/admin/alibaba-codes",s);d.value=o.data.items||[],i.value=o.data.total,t.value=a}catch(s){m.value=s.message||"خطا در دریافت کدها"}finally{r.value=!1}};return k(()=>x.query,async a=>{a.page?t.value=parseInt(a.page):t.value=1,await b(t.value)},{immediate:!0}),k(()=>t.value,a=>{const s={...x.query,page:a};y.push({query:s})}),U(()=>{}),(a,s)=>(l(),p("div",W,[e("div",X,[s[3]||(s[3]=e("h1",{class:"text-xl font-bold text-purple-700"},"کدهای علی‌بابا",-1)),e("button",{onClick:s[0]||(s[0]=o=>n.value=!0),class:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors duration-200"}," ایجاد کد جدید ")]),$(K,{"is-open":n.value,onClose:s[1]||(s[1]=o=>n.value=!1),onCreated:b},null,8,["is-open"]),r.value?(l(),p("div",Y,s[4]||(s[4]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"},null,-1)]))):m.value?(l(),p("div",Z,c(m.value),1)):(l(),p("div",Q,[e("div",ee,[e("table",te,[s[5]||(s[5]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"کد"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"نوع"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"وضعیت"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"تاریخ ایجاد"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"تاریخ تخصیص"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"کاربر تخصیص داده شده")])],-1)),e("tbody",se,[(l(!0),p(E,null,F(d.value,o=>{var w,h;return l(),p("tr",{key:o.id},[e("td",oe,c(o.code),1),e("td",ae,c(M(o.type)),1),e("td",re,[e("span",{class:H([o.used?"bg-red-100 text-red-800":"bg-green-100 text-green-800","px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},c(o.used?"استفاده شده":"فعال"),3)]),e("td",ne,c(C(g)(o.created_at)),1),e("td",le,c(o.assign_at?C(g)(o.assign_at):"-"),1),e("td",ie,c(o.assign_to_user_id?((w=o.assign_to_user)==null?void 0:w.first_name)+" "+((h=o.assign_to_user)==null?void 0:h.last_name):"-"),1)])}),128))])])]),$(R,{"current-page":t.value,"onUpdate:currentPage":s[2]||(s[2]=o=>t.value=o),"total-items":i.value,"per-page":q},null,8,["current-page","total-items"])]))]))}};export{ce as default};
