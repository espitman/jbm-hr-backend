import{j as q,k as B,r as c,E as V,o as i,w as D,a as e,m as F,n as N,v as z,t as y,s as M,c as g,y as C,F as S,b as w,D as P,G as A,A as h,q as E,C as L,z as O,x as $}from"./FE44vmqp.js";import{_ as R}from"./CxlkBo9E.js";import{_ as T,a as G}from"./BjKY6zKH.js";const H={class:"flex justify-end space-x-3"},J=["disabled"],K={__name:"CreateCodeModal",props:{isOpen:{type:Boolean,required:!0}},emits:["close","created"],setup(f,{emit:b}){const x=b,{$api:u}=q(),m=B(),p=c(!1),o=c({code:""}),a=()=>{x("close")},n=async()=>{try{p.value=!0,await u.post("/api/v1/admin/digikala-codes",o.value),m.success("کد با موفقیت ایجاد شد"),a(),x("created"),o.value={code:""}}catch(d){m.error("خطا در ایجاد کد"),console.error(d)}finally{p.value=!1}};return(d,v)=>(i(),V(R,{"is-open":f.isOpen,title:"ایجاد کد جدید","show-cancel-button":!1,"show-footer":!1,onClose:a},{default:D(()=>[e("form",{onSubmit:F(n,["prevent"]),class:"space-y-4"},[e("div",null,[v[1]||(v[1]=e("label",{for:"code",class:"block text-sm font-medium text-gray-700 mb-1"},"کد",-1)),N(e("input",{id:"code","onUpdate:modelValue":v[0]||(v[0]=r=>o.value.code=r),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-200 focus:border-purple-300",required:""},null,512),[[z,o.value.code]])]),e("div",H,[e("button",{type:"button",onClick:a,class:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors duration-200"}," انصراف "),e("button",{type:"submit",disabled:p.value,class:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors duration-200 disabled:opacity-50"},y(p.value?"در حال ایجاد...":"ایجاد"),9,J)])],32)]),_:1},8,["is-open"]))}},W={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 items-end"},X={class:"flex flex-col"},Y=["value"],Z={class:"flex flex-col"},Q={class:"flex flex-col items-end"},ee={__name:"Filters",props:{used:{type:String,default:""},userId:{type:String,default:""},defaultUserId:{type:String,default:""}},emits:["update:used","update:userId","clear"],setup(f,{emit:b}){const x=f,u=b,m=M(()=>!!(x.used||x.userId)),p=o=>{const a=o.target.value;u("update:used",a),a==="false"&&u("update:userId","")};return(o,a)=>(i(),g("div",W,[e("div",X,[a[3]||(a[3]=e("label",{class:"text-sm font-medium text-gray-700 mb-1"},"وضعیت",-1)),e("select",{class:"rounded-lg border border-gray-200 bg-white px-3 py-2 text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-200 focus:border-purple-300 transition w-full text-sm",value:f.used,onChange:p},a[2]||(a[2]=[e("option",{value:"",class:"text-gray-400"},"همه وضعیت‌ها",-1),e("option",{value:"true"},"استفاده شده",-1),e("option",{value:"false"},"فعال",-1)]),40,Y)]),e("div",Z,[f.used==="true"?(i(),g(S,{key:0},[a[4]||(a[4]=e("label",{class:"text-sm font-medium text-gray-700 mb-1"},"شناسه کاربر",-1)),w(T,{placeholder:"نام، ایمیل یا شماره کاربر را جستجو کنید","default-user-id":f.defaultUserId,onSelect:a[0]||(a[0]=n=>u("update:userId",(n==null?void 0:n.id)||""))},null,8,["default-user-id"])],64)):C("",!0)]),e("div",Q,[m.value?(i(),g("button",{key:0,type:"button",class:"h-10 w-auto flex items-center justify-center gap-1 px-3 rounded-lg bg-red-500 text-white hover:bg-red-600 transition border-none mt-0",onClick:a[1]||(a[1]=n=>o.$emit("clear")),title:"پاک کردن فیلترها"},a[5]||(a[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),e("span",{class:"text-xs"},"پاک کردن",-1)]))):C("",!0)])]))}},te={class:"container mx-auto p-4"},se={class:"flex items-center justify-between mb-6"},ae={key:0,class:"flex justify-center items-center py-8"},re={key:1,class:"text-center text-red-500"},le={key:2},oe={class:"bg-white shadow-md rounded-lg overflow-hidden"},ue={class:"min-w-full divide-y divide-gray-200"},ne={class:"bg-white divide-y divide-gray-200"},de={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ie={class:"px-6 py-4 whitespace-nowrap text-sm"},pe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},I=10,ve={__name:"list",setup(f){const{$api:b,$formatDate:x}=q(),u=P(),m=A(),p=c([]),o=c(!0),a=c(null),n=c(!1),d=c(1),v=c(0),r=c({used:"",userId:""}),U=M(()=>u.query.user_id||""),_=async(l=1)=>{try{o.value=!0,a.value=null;const t={page:l,page_size:I};r.value.used&&(t.used=r.value.used),r.value.userId&&(t.user_id=r.value.userId);const s=await b.get("/api/v1/admin/digikala-codes",t);p.value=s.data.items||[],v.value=s.data.total,d.value=l}catch(t){a.value=t.message||"خطا در دریافت کدها"}finally{o.value=!1}};h(()=>u.query,async l=>{r.value.used=l.used||"",r.value.userId=l.user_id||"",l.page?d.value=parseInt(l.page):d.value=1,await _(d.value)},{immediate:!0}),h(()=>[r.value.used,r.value.userId],([l,t])=>{const s={...u.query,page:1};l?s.used=l:delete s.used,t?s.user_id=t:delete s.user_id,m.push({query:s})}),h(()=>d.value,l=>{const t={...u.query,page:l};m.push({query:t})});const j=()=>{r.value.used="",r.value.userId=""};return E(()=>{}),(l,t)=>(i(),g("div",te,[e("div",se,[t[5]||(t[5]=e("h1",{class:"text-xl font-bold text-purple-700"},"کدهای دیجی‌کالا",-1)),e("button",{onClick:t[0]||(t[0]=s=>n.value=!0),class:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors duration-200"}," ایجاد کد جدید ")]),w(K,{"is-open":n.value,onClose:t[1]||(t[1]=s=>n.value=!1),onCreated:_},null,8,["is-open"]),w(ee,{used:r.value.used,"user-id":r.value.userId,"default-user-id":U.value,"onUpdate:used":t[2]||(t[2]=s=>r.value.used=s),"onUpdate:userId":t[3]||(t[3]=s=>r.value.userId=s),onClear:j},null,8,["used","user-id","default-user-id"]),o.value?(i(),g("div",ae,t[6]||(t[6]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"},null,-1)]))):a.value?(i(),g("div",re,y(a.value),1)):(i(),g("div",le,[e("div",oe,[e("table",ue,[t[7]||(t[7]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"شناسه"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"وضعیت"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"تاریخ ایجاد"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"تاریخ تخصیص"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"کاربر تخصیص داده شده")])],-1)),e("tbody",ne,[(i(!0),g(S,null,L(p.value,s=>{var k;return i(),g("tr",{key:s.id},[e("td",de,y(s.id),1),e("td",ie,[e("span",{class:O([s.used?"bg-red-100 text-red-800":"bg-green-100 text-green-800","px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},y(s.used?"استفاده شده":"فعال"),3)]),e("td",pe,y($(x)(s.created_at)),1),e("td",ce,y(s.assign_at?$(x)(s.assign_at):"-"),1),e("td",ge,y(((k=s.assigned_to_user)==null?void 0:k.full_name)||"-"),1)])}),128))])])]),w(G,{"current-page":d.value,"onUpdate:currentPage":t[4]||(t[4]=s=>d.value=s),"total-items":v.value,"per-page":I},null,8,["current-page","total-items"])]))]))}};export{ve as default};
