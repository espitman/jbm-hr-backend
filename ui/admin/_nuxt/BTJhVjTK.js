import{g as C,q as j,r as f,j as P,c as u,o as p,a as e,b as $,t as h,n as V,A as I,w as D,d as T,F as Y,x,l as N,y as _,v as A,B as E,k as H,C as B,m as L,D as R}from"./D_B6tzIL.js";import{_ as z}from"./DujgF2Ac.js";import{_ as G}from"./zWiw_lry.js";import{D as J}from"./DDgOF7DI.js";const K={class:"bg-white rounded-lg shadow p-6 flex flex-col items-center"},Q=["src"],W={key:1,class:"h-full w-full flex items-center justify-center bg-gray-200"},X={class:"text-gray-500 text-4xl"},Z={class:"text-lg font-semibold mt-4"},ee={class:"text-sm text-gray-500"},te={class:"w-full mt-6 space-y-2 text-sm"},oe={class:"flex justify-between items-center"},se={class:"flex items-center gap-2"},ae={class:"text-gray-900"},le={class:"flex justify-between items-center"},re={class:"flex items-center gap-2"},ne={class:"text-gray-900"},ie={class:"text-sm font-medium text-center"},de={class:"p-4"},ue={class:"flex justify-end gap-2"},pe=["disabled"],ce=["disabled"],me={key:0,class:"flex items-center gap-2"},fe={key:1},ve={__name:"ProfileCard",props:{avatar:{type:String,default:""},name:{type:String,required:!0},role:{type:String,required:!0},userId:{type:[String,Number],required:!0},birthdate:{type:String,default:""},cooperation_start_date:{type:String,default:""},confirmed:{type:Boolean,default:!1}},emits:["update:avatar","success","update:birthdate","update:cooperation_start_date"],setup(n,{emit:k}){const{$api:w,$formatDateOnly:l}=C(),v=n,o=k,a=j(),c=f(!1),b=f(!1),i=f(null),m=f(null),y=f(!1),s=P(()=>m.value==="birthdate"?"تغییر تاریخ تولد":"تغییر تاریخ شروع همکاری"),t=()=>{c.value=!0},r=()=>{c.value=!1},S=g=>{m.value=g,i.value=v[g]||"",b.value=!0},U=()=>{b.value=!1,m.value=null,i.value=null},q=async()=>{try{y.value=!0;const g=m.value==="birthdate"?`/api/v1/admin/users/${v.userId}/birthdate`:`/api/v1/admin/users/${v.userId}/cooperation-start-date`;await w.put(g,{[m.value]:i.value}),o(`update:${m.value}`,i.value),o("success"),U(),a.success("تاریخ با موفقیت بروزرسانی شد")}catch{a.error("خطا در بروزرسانی تاریخ")}finally{y.value=!1}},F=async g=>{try{await w.put(`/api/v1/admin/users/${v.userId}/avatar`,{avatar:g}),o("update:avatar",g),o("success"),r()}catch{a.error("خطا در بروزرسانی تصویر پروفایل")}},O=g=>{const d=g.split(" ");return d.length>=2?`${d[0][0]}${d[1][0]}`:g[0]};return(g,d)=>(p(),u(Y,null,[e("div",K,[e("div",{class:"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow cursor-pointer",onClick:t},[n.avatar?(p(),u("img",{key:0,class:"w-full h-full object-cover",src:n.avatar,alt:"User Avatar"},null,8,Q)):(p(),u("div",W,[e("span",X,h(O(n.name)),1)]))]),e("div",Z,h(n.name),1),e("div",ee,h(n.role),1),e("div",te,[e("div",oe,[d[4]||(d[4]=e("span",{class:"text-gray-500"},"تاریخ تولد:",-1)),e("div",se,[e("span",ae,h(V(l)(n.birthdate)),1),e("button",{onClick:d[0]||(d[0]=M=>S("birthdate")),class:"text-purple-600 hover:text-purple-700"},d[3]||(d[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]))])]),e("div",le,[d[6]||(d[6]=e("span",{class:"text-gray-500"},"تاریخ شروع همکاری:",-1)),e("div",re,[e("span",ne,h(V(l)(n.cooperation_start_date)),1),e("button",{onClick:d[1]||(d[1]=M=>S("cooperation_start_date")),class:"text-purple-600 hover:text-purple-700"},d[5]||(d[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]))])])]),e("div",{class:I(["w-full mt-6 p-4 rounded-lg",n.confirmed?"bg-green-50 text-green-700":"bg-yellow-50 text-yellow-700"])},[e("p",ie,h(n.confirmed?"اطلاعات توسط کاربر تایید شده است.":"اطلاعات هنوز توسط کاربر تایید نشده است."),1)],2)]),$(z,{"is-open":c.value,title:"تغییر تصویر پروفایل",size:"md","show-cancel-button":!1,"show-footer":!1,onClose:r},{default:D(()=>[$(G,{dir:"avatars",onUploaded:F})]),_:1},8,["is-open"]),$(z,{"is-open":b.value,title:s.value,size:"sm",onClose:U},{footer:D(()=>[e("div",ue,[e("button",{onClick:U,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",disabled:y.value}," انصراف ",8,pe),e("button",{onClick:q,class:"px-4 py-2 text-sm font-medium text-white bg-purple-600 border border-transparent rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:y.value},[y.value?(p(),u("span",me,d[7]||(d[7]=[e("svg",{class:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),T(" در حال ذخیره... ")]))):(p(),u("span",fe,"ذخیره"))],8,ce)])]),default:D(()=>[e("div",de,[$(V(J),{modelValue:i.value,"onUpdate:modelValue":d[2]||(d[2]=M=>i.value=M),format:"YYYY-MM-DD","display-format":"jYYYY-jMM-jDD",editable:!1,"auto-submit":!1,"input-class":"w-full px-3 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,8,["modelValue"])])]),_:1},8,["is-open","title"])],64))}},be={class:"bg-white rounded-lg shadow p-6 flex flex-col items-center"},ge=["disabled"],ye=["disabled"],xe={class:"flex gap-2 mt-2"},we=["disabled"],he={key:0,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white inline-block mr-2"},_e={key:1},ke=["disabled"],$e={key:0,class:"text-xs text-gray-500 text-center mt-2"},Ce={__name:"EditPasswordCard",props:{role:{type:String,default:"employee"},userId:{type:[String,Number],required:!0}},emits:["updated"],setup(n,{emit:k}){const w=n,l=k,{$api:v}=C(),o=j(),a=f({password:"",password_confirmation:""}),c=f(!1),b=f(null),i=()=>{a.value={password:"",password_confirmation:""}},m=async()=>{try{if(c.value=!0,b.value=null,a.value.password!==a.value.password_confirmation){o.error("رمز عبور و تکرار آن مطابقت ندارند"),c.value=!1;return}await v.put(`/api/v1/admin/users/${w.userId}/password`,a.value),o.success("رمز عبور با موفقیت بروزرسانی شد"),i(),l("updated")}catch(y){b.value=y.message||"خطا در بروزرسانی رمز عبور",o.error(b.value)}finally{c.value=!1}};return(y,s)=>(p(),u("div",be,[s[2]||(s[2]=e("div",{class:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4 border-4 border-white shadow"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})])],-1)),s[3]||(s[3]=e("div",{class:"text-sm font-medium mb-4"},"تغییر رمز عبور",-1)),e("form",{class:I(["w-full space-y-3",{"opacity-50 pointer-events-none":n.role!=="admin"}]),onSubmit:A(m,["prevent"])},[x(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>a.value.password=t),type:"password",placeholder:"رمز عبور جدید",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm placeholder:text-right",disabled:n.role!=="admin",dir:"ltr"},null,8,ge),[[_,a.value.password]]),x(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>a.value.password_confirmation=t),type:"password",placeholder:"تکرار رمز عبور جدید",class:"w-full border border-gray-300 rounded px-3 py-2 text-sm placeholder:text-right",disabled:n.role!=="admin",dir:"ltr"},null,8,ye),[[_,a.value.password_confirmation]]),e("div",xe,[e("button",{type:"submit",class:"flex-1 bg-green-500 text-white py-2 rounded cursor-pointer flex items-center justify-center",disabled:n.role!=="admin"||c.value},[c.value?(p(),u("span",he)):(p(),u("span",_e,"بروزرسانی"))],8,we),e("button",{type:"button",class:"flex-1 bg-red-400 text-white py-2 rounded cursor-pointer",disabled:n.role!=="admin"||c.value,onClick:i}," انصراف ",8,ke)]),n.role!=="admin"?(p(),u("p",$e,"امکان ست کردن رمز عبور فقط برای رول ادمین است.")):N("",!0)],34)]))}},Ue={class:"bg-white rounded-lg shadow p-6"},Me=["value"],Ve={class:"pt-2"},De=["disabled"],je={key:0,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"},Se={key:1},Be={key:0,class:"text-red-600 text-sm text-center bg-red-50 py-2 px-4 rounded-lg"},ze={__name:"EditProfileForm",props:{user:{type:Object,default:()=>({id:null,email:"",phone:"",role:"employee",first_name:"",last_name:"",department_id:"",personnel_number:"",national_code:""})}},emits:["updated"],setup(n,{emit:k}){const w=n,{$api:l}=C(),v=j(),o=f({email:"",phone:"",role:"employee",first_name:"",last_name:"",department_id:"",personnel_number:"",national_code:""}),a=f(!1),c=f(null),b=f([]),i=k;E(()=>w.user,s=>{var t;s&&(o.value={email:s.email,phone:s.phone,role:s.role,first_name:s.first_name,last_name:s.last_name,department_id:((t=s.department)==null?void 0:t.id)||"",personnel_number:s.personnel_number||"",national_code:s.national_code||""})},{immediate:!0});const m=async()=>{try{a.value=!0;const s=await l.get("/api/v1/departments");b.value=s.data.departments||[]}catch{v.error("خطا در دریافت لیست دپارتمان‌ها")}finally{a.value=!1}},y=async()=>{try{a.value=!0,c.value=null,await l.put(`/api/v1/admin/users/${w.user.id}`,o.value),v.success("پروفایل با موفقیت بروزرسانی شد"),i("updated")}catch(s){c.value=s.message||"خطا در بروزرسانی پروفایل",v.error(c.value)}finally{a.value=!1}};return H(()=>{m()}),(s,t)=>(p(),u("div",Ue,[t[18]||(t[18]=e("h2",{class:"text-lg font-bold mb-4"},"ویرایش پروفایل",-1)),e("form",{class:"space-y-6",onSubmit:A(y,["prevent"])},[e("div",null,[t[8]||(t[8]=e("label",{for:"first_name",class:"block text-sm font-medium text-gray-700 mb-1"},"نام",-1)),x(e("input",{id:"first_name","onUpdate:modelValue":t[0]||(t[0]=r=>o.value.first_name=r),type:"text",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[_,o.value.first_name]])]),e("div",null,[t[9]||(t[9]=e("label",{for:"last_name",class:"block text-sm font-medium text-gray-700 mb-1"},"نام خانوادگی",-1)),x(e("input",{id:"last_name","onUpdate:modelValue":t[1]||(t[1]=r=>o.value.last_name=r),type:"text",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[_,o.value.last_name]])]),e("div",null,[t[10]||(t[10]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-1"},"ایمیل",-1)),x(e("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=r=>o.value.email=r),type:"email",dir:"ltr",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[_,o.value.email]])]),e("div",null,[t[11]||(t[11]=e("label",{for:"phone",class:"block text-sm font-medium text-gray-700 mb-1"},"شماره موبایل",-1)),x(e("input",{id:"phone","onUpdate:modelValue":t[3]||(t[3]=r=>o.value.phone=r),type:"tel",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[_,o.value.phone]])]),e("div",null,[t[13]||(t[13]=e("label",{for:"role",class:"block text-sm font-medium text-gray-700 mb-1"},"نقش",-1)),x(e("select",{id:"role","onUpdate:modelValue":t[4]||(t[4]=r=>o.value.role=r),class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},t[12]||(t[12]=[e("option",{value:"admin"},"مدیر",-1),e("option",{value:"employee"},"کارمند",-1)]),512),[[B,o.value.role]])]),e("div",null,[t[15]||(t[15]=e("label",{for:"department_id",class:"block text-sm font-medium text-gray-700 mb-1"},"دپارتمان",-1)),x(e("select",{id:"department_id","onUpdate:modelValue":t[5]||(t[5]=r=>o.value.department_id=r),class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},[t[14]||(t[14]=e("option",{value:""},"انتخاب دپارتمان",-1)),(p(!0),u(Y,null,L(b.value,r=>(p(),u("option",{key:r.id,value:r.id},h(r.title),9,Me))),128))],512),[[B,o.value.department_id]])]),e("div",null,[t[16]||(t[16]=e("label",{for:"personnel_number",class:"block text-sm font-medium text-gray-700 mb-1"},"شماره پرسنلی",-1)),x(e("input",{id:"personnel_number","onUpdate:modelValue":t[6]||(t[6]=r=>o.value.personnel_number=r),type:"text",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[_,o.value.personnel_number]])]),e("div",null,[t[17]||(t[17]=e("label",{for:"national_code",class:"block text-sm font-medium text-gray-700 mb-1"},"کد ملی",-1)),x(e("input",{id:"national_code","onUpdate:modelValue":t[7]||(t[7]=r=>o.value.national_code=r),type:"text",class:"block w-full px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-colors"},null,512),[[_,o.value.national_code]])]),e("div",Ve,[e("button",{type:"submit",class:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors cursor-pointer",disabled:a.value},[a.value?(p(),u("span",je)):(p(),u("span",Se,"بروزرسانی"))],8,De)]),c.value?(p(),u("div",Be,h(c.value),1)):N("",!0)],32)]))}},Ie={class:"container mx-auto p-0"},Ye={key:0,class:"flex justify-center items-center h-64"},Ne={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},Ae={class:"block sm:inline"},He={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},qe={class:"col-span-1 space-y-6"},Fe={class:"col-span-2"},Le={__name:"[id]",setup(n){const k=R(),{$api:w}=C(),l=f({}),v=f(!0),o=f(null),a=async()=>{try{v.value=!0,o.value=null;const i=await w.get(`/api/v1/admin/users/${k.params.id}`);l.value=i.data||{}}catch(i){o.value=i.message||"خطا در دریافت اطلاعات کاربر"}finally{v.value=!1}},c=i=>{l.value.birthdate=i},b=i=>{l.value.cooperation_start_date=i};return H(()=>{a()}),(i,m)=>(p(),u("div",Ie,[m[1]||(m[1]=e("h1",{class:"text-xl font-bold text-purple-700 mb-6"},"ویرایش پروفایل",-1)),v.value?(p(),u("div",Ye,m[0]||(m[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-700"},null,-1)]))):o.value?(p(),u("div",Ne,[e("span",Ae,h(o.value),1)])):(p(),u("div",He,[e("div",qe,[$(ve,{avatar:l.value.avatar,name:l.value.first_name+" "+l.value.last_name,role:l.value.role==="admin"?"مدیر":"کارمند",userId:l.value.id,birthdate:l.value.birthdate,cooperation_start_date:l.value.cooperation_start_date,confirmed:l.value.confirmed,"onUpdate:avatar":i.handleAvatarUpdate,"onUpdate:birthdate":c,"onUpdate:cooperation_start_date":b,onSuccess:a},null,8,["avatar","name","role","userId","birthdate","cooperation_start_date","confirmed","onUpdate:avatar"]),$(Ce,{role:l.value.role,"user-id":l.value.id,onUpdated:a},null,8,["role","user-id"])]),e("div",Fe,[$(ze,{user:l.value,onUpdated:a},null,8,["user"])])]))]))}};export{Le as default};
