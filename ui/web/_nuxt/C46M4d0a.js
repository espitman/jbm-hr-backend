import{e as p,s as A,v as D,f as E,x as k,y as H,c as i,o as u,a as t,q as S,j,l as T,z as x,A as g,d as f,t as b,F as q,r as I}from"./Bdf7j8XG.js";const N={class:"min-h-screen flex items-center justify-center bg-gradient-to-br from-amber-50 to-amber-100 py-12 px-4 sm:px-6 lg:px-8"},_={class:"max-w-md w-full space-y-8"},U={class:"mt-8 bg-white py-8 px-4 shadow-xl rounded-xl sm:px-10 transform transition-all duration-300 hover:shadow-2xl"},K={class:"mt-1 relative rounded-md shadow-sm"},L=["disabled"],$={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},F={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},G={class:"text-center text-sm text-gray-600 mb-6 bg-amber-50 p-4 rounded-lg border border-amber-100"},J={class:"mt-2 text-amber-600 font-medium",dir:"ltr"},Q={class:"mt-1 flex justify-center gap-2 flex-row-reverse"},R=["onUpdate:modelValue","onInput","onKeydown"],W={class:"flex items-center justify-between"},X=["disabled"],Y={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Z={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 ml-2 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},se={__name:"login",setup(ee){const m=p(1),d=p(""),c=p(""),l=p(["","","","","",""]),r=p(!1),{login:C}=A(),a=D(),{$api:w}=E();k(m,s=>{s===2&&setTimeout(()=>{const e=document.querySelectorAll('input[type="text"]');e.length>0&&e[0].focus()},0)});const V=H(()=>l.value.join(""));k(V,s=>{c.value=s});const M=(s,e)=>{const o=s.target.value;if(!/^\d*$/.test(o)){l.value[e]="";return}l.value[e]=o,o&&e<5&&setTimeout(()=>{const n=s.target.parentElement.children[e+1];n&&n.focus()},0),e===5&&o&&setTimeout(()=>{h()},100)},B=(s,e)=>{if(s.key==="Backspace")if(!l.value[e]&&e>0){l.value[e-1]="";const o=s.target.parentElement.children[e-1];o&&o.focus()}else l.value[e]=""},z=s=>{s.preventDefault();const o=s.clipboardData.getData("text").match(/\d/g);o&&(o.slice(0,6).forEach((n,v)=>{v<6&&(l.value[v]=n,v<5&&setTimeout(()=>{const y=s.target.parentElement.children[v+1];y&&y.focus()},0))}),o.length>=6&&setTimeout(()=>{h()},100))},O=async()=>{if(!d.value){a.error("لطفا ایمیل خود را وارد کنید");return}r.value=!0;try{const s=await w.auth.requestOTP(d.value);m.value=2,a.success("کد تایید به ایمیل شما ارسال شد")}catch(s){if(s.message==="active OTP already exists")m.value=2,a.info("کد تایید قبلی هنوز معتبر است");else{const e=s instanceof Error?s.message:"خطا در ارسال کد تایید";a.error(e)}}finally{r.value=!1}},h=async()=>{if(c.value.length!==6){a.error("کد تایید باید 6 رقم باشد");return}r.value=!0;try{const s=await w.auth.verifyOTP(d.value,c.value);if(console.log("Login response:",s),s&&s.data)C(s.data.token,{id:s.data.user.id,email:s.data.user.email,name:s.data.user.firstName+" "+s.data.user.lastName}),a.success("ورود با موفقیت انجام شد"),window.location.href="/";else throw console.error("Invalid response structure:",s),new Error("پاسخ نامعتبر از سرور")}catch(s){console.error("OTP verification error:",s),a.error(s.message||"خطا در تایید کد")}finally{r.value=!1}},P=async()=>{r.value=!0;try{l.value=["","","","","",""],setTimeout(()=>{const e=document.querySelectorAll('input[type="text"]');e.length>0&&e[0].focus()},0);const s=await w.auth.requestOTP(d.value);a.success("کد تایید جدید به ایمیل شما ارسال شد")}catch(s){s.message==="active OTP already exists"?a.info("کد تایید قبلی هنوز معتبر است"):a.error(s.message||"خطا در ارسال مجدد کد تایید")}finally{r.value=!1}};return(s,e)=>(u(),i("div",N,[t("div",_,[e[15]||(e[15]=S('<div class="text-center"><div class="flex justify-center"><div class="w-20 h-20 bg-amber-500 rounded-full flex items-center justify-center shadow-lg transform transition-transform hover:scale-105"><svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div></div><h2 class="mt-6 text-3xl font-extrabold text-gray-900"> ورود به سیستم </h2><p class="mt-2 text-sm text-gray-600"> برای دسترسی به اطلاعات خود وارد شوید </p></div>',1)),t("div",U,[m.value===1?(u(),i("form",{key:0,onSubmit:T(O,["prevent"]),class:"space-y-6"},[t("div",null,[e[4]||(e[4]=t("label",{for:"email",class:"block text-sm font-medium text-gray-700"}," ایمیل سازمانی ",-1)),t("div",K,[e[3]||(e[3]=t("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})])],-1)),x(t("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=o=>d.value=o),name:"email",type:"email",autocomplete:"email",required:"",dir:"ltr",class:"appearance-none block w-full px-3 py-2 pr-10 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm text-left",placeholder:"example@jabama.com"},null,512),[[g,d.value]])])]),t("div",null,[t("button",{type:"submit",disabled:r.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},[r.value?(u(),i("svg",$,e[5]||(e[5]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(u(),i("svg",F,e[6]||(e[6]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"},null,-1)]))),f(" "+b(r.value?"در حال ارسال...":"دریافت کد تایید"),1)],8,L)])],32)):j("",!0),m.value===2?(u(),i("form",{key:1,onSubmit:T(h,["prevent"]),class:"space-y-6"},[t("div",G,[e[7]||(e[7]=t("div",{class:"flex items-center justify-center mb-2"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-amber-500 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),t("p",{class:"font-medium"},"کد تایید ارسال شد")],-1)),e[8]||(e[8]=t("p",null,"کد شش رقمی به ایمیل سازمانی شما ارسال شد.",-1)),e[9]||(e[9]=t("p",null,"شما ۳ دقیقه فرصت دارید تا با استفاده از آن وارد شوید.",-1)),t("div",J,b(d.value),1)]),t("div",null,[e[10]||(e[10]=t("label",{for:"otp",class:"block text-sm font-medium text-gray-700"}," کد تایید ",-1)),t("div",Q,[(u(),i(q,null,I(6,o=>x(t("input",{key:o,"onUpdate:modelValue":n=>l.value[o-1]=n,type:"text",maxlength:"1",pattern:"[0-9]*",inputmode:"numeric",dir:"ltr",class:"w-12 h-12 text-center text-xl font-bold border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all duration-200",onInput:n=>M(n,o-1),onKeydown:n=>B(n,o-1),onPaste:z},null,40,R),[[g,l.value[o-1]]])),64))]),x(t("input",{type:"hidden","onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),name:"otp",required:""},null,512),[[g,c.value]])]),t("div",W,[t("button",{type:"button",onClick:e[2]||(e[2]=o=>m.value=1),class:"text-sm text-amber-600 hover:text-amber-500 flex items-center transition-colors duration-200"},e[11]||(e[11]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),f(" تغییر ایمیل ")])),t("button",{type:"button",onClick:P,class:"text-sm text-amber-600 hover:text-amber-500 flex items-center transition-colors duration-200"},e[12]||(e[12]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),f(" ارسال مجدد کد ")]))]),t("div",null,[t("button",{type:"submit",disabled:r.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},[r.value?(u(),i("svg",Y,e[13]||(e[13]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(u(),i("svg",Z,e[14]||(e[14]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"},null,-1)]))),f(" "+b(r.value?"در حال ورود...":"ورود"),1)],8,X)])],32)):j("",!0)])])]))}};export{se as default};
